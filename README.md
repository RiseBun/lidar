# å¢å¼ºç‰ˆæ¿€å…‰é›·è¾¾æƒ¯æ€§é‡Œç¨‹è®¡ä¸å»ºå›¾ç³»ç»Ÿ

è¿™æ˜¯ä¸€ä¸ªåŸºäº FAST-LIO2 çš„æ·±åº¦å¢å¼ºç‰ˆæœ¬ï¼Œä¸“ä¸º Livox ç³»åˆ—æ¿€å…‰é›·è¾¾ï¼ˆå¦‚ Mid-360, Aviaï¼‰è®¾è®¡ä¸ä¼˜åŒ–ã€‚

ç›¸æ¯”åŸç‰ˆï¼Œå®ƒä¸ä»…ä»…æ˜¯ä¸€ä¸ªâ€œé‡Œç¨‹è®¡â€ï¼Œæ›´æ˜¯ä¸€ä¸ªå®Œæ•´çš„ SLAM ç³»ç»Ÿã€‚æ‚¨å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€éƒ¨ç”µå½±åˆ¶ä½œå›¢é˜Ÿï¼š**å‰ç«¯è´Ÿè´£æ‹æ‘„ç´ æï¼ˆå»ºå›¾ï¼‰ï¼Œåç«¯è´Ÿè´£å‰ªè¾‘æ‹¼æ¥ï¼ˆå›ç¯ä¼˜åŒ–ï¼‰ï¼Œæœ€åè¿˜èƒ½ç”¨æ¥æ”¾æ˜ ï¼ˆé‡å®šä½ï¼‰ã€‚**

---

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½

æœ¬é¡¹ç›®åŒ…å«å››å¤§æ ¸å¿ƒæ¨¡å—ï¼Œä¸ºæ‚¨æä¾›ä»å»ºå›¾åˆ°åº”ç”¨çš„å…¨æµç¨‹è§£å†³æ–¹æ¡ˆï¼š

- **å‰ç«¯å»ºå›¾ (LIO Mapping)**
    - å®æ—¶è¿è¡Œ FAST-LIO2 é‡Œç¨‹è®¡ï¼Œæ„å»ºé«˜ç²¾åº¦åœ°å›¾ã€‚
    - **å¢å¼ºåŠŸèƒ½**ï¼šæ”¯æŒåœ¨çº¿å›ç¯æ£€æµ‹ï¼ˆScan Contextï¼‰ï¼Œæ”¯æŒå°†å…³é”®å¸§å’Œæè¿°å­ä¿å­˜è‡³ç¡¬ç›˜ï¼ˆä¸ºç¦»çº¿ä¼˜åŒ–åšå‡†å¤‡ï¼‰ã€‚
    - **ç‰¹è‰²**ï¼šæ”¯æŒåŠ¨æ€ç‰©ä½“å‰”é™¤ï¼ˆå°†ç§»åŠ¨çš„äºº/è½¦ä»åœ°å›¾ä¸­å‰”é™¤ï¼Œä½¿åœ°å›¾æ›´å¹²å‡€ã€æ›´é™æ€ï¼‰ã€‚

- **å¤šé˜¶æ®µè”åˆä¼˜åŒ– (Multi-session Mapping)**
    - **ç¦»çº¿â€œæ‹¼å›¾â€åŠŸèƒ½**ã€‚
    - **åº”ç”¨åœºæ™¯**ï¼šå¦‚æœæ‚¨æ˜¨å¤©å½•äº†ä¸€æ®µè·¯ï¼Œä»Šå¤©åˆå½•äº†ä¸€æ®µè·¯ã€‚è¿™ä¸ªåŠŸèƒ½å¯ä»¥è‡ªåŠ¨æ£€æµ‹ä¸¤æ®µè·¯é‡åˆçš„åœ°æ–¹ï¼ŒæŠŠå®ƒä»¬æ‹¼æˆä¸€å¼ å®Œæ•´çš„ã€æ— æ¼‚ç§»çš„å…¨å±€å¤§åœ°å›¾ã€‚

- **åœ¨çº¿é‡å®šä½ (Online Relocalization)**
    - **å·²çŸ¥åœ°å›¾å®šä½**ã€‚
    - **åº”ç”¨åœºæ™¯**ï¼šæ‰‹é‡Œå·²ç»æœ‰ä¸€å¼ åšå¥½çš„åœ°å›¾ï¼Œæœºå™¨äººå¼€æœºåï¼Œä¸å†æ–°å»ºåœ°å›¾ï¼Œè€Œæ˜¯é€šè¿‡é›·è¾¾æ•°æ®å¿«é€ŸåŒ¹é…ï¼ŒçŸ¥é“è‡ªå·±åœ¨åœ°å›¾çš„å“ªä¸ªè§’è½ã€‚

- **åŠ¨æ€æ¶ˆé™¤ (Object-level Updating)**
    - **å±€éƒ¨ä¿®è¡¥åŠŸèƒ½**ã€‚
    - **åº”ç”¨åœºæ™¯**ï¼šåœ°å›¾å¤§éƒ¨åˆ†æ²¡å˜ï¼Œåªæœ‰æŸä¸ªè§’è½å¤šäº†ä¸€è¾†è½¦æˆ–å°‘äº†ä¸€å µå¢™ã€‚è¿™ä¸ªåŠŸèƒ½å¯ä»¥åªæ›´æ–°é‚£ä¸€å°å—åŒºåŸŸï¼Œè€Œä¸æ˜¯é‡è·‘æ•´ä¸ªåœ°å›¾ï¼Œæå¤§åœ°æé«˜äº†æ•ˆç‡ã€‚

---

## âš™ï¸ ç¯å¢ƒé…ç½®

> **è­¦å‘Šï¼šä¾èµ–ç‰ˆæœ¬éå¸¸å…³é”®ï¼Œè¯·ä¸¥æ ¼éµå®ˆï¼**

- **æ“ä½œç³»ç»Ÿ**ï¼šUbuntu 20.04 (ROS Noetic)
- **PCL & Eigen**ï¼šä½¿ç”¨ç³»ç»Ÿé»˜è®¤å³å¯ã€‚
- **GTSAM**ï¼š**å¿…é¡»ä½¿ç”¨ 4.0.3 ç¨³å®šç‰ˆ**ã€‚
    - **ä¸è¦ä½¿ç”¨** GitHub ä¸Šçš„æœ€æ–° develop/4.2a ç‰ˆæœ¬ï¼Œå¦åˆ™ä¼šæŠ¥ abstract class ç¼–è¯‘é”™è¯¯ã€‚

### å®‰è£… GTSAM 4.0.3
```bash
wget https://github.com/borglab/gtsam/archive/refs/tags/4.0.3.zip
unzip 4.0.3.zip && cd gtsam-4.0.3/build
cmake .. -DGTSAM_USE_SYSTEM_EIGEN=ON -DGTSAM_BUILD_WITH_MARCH_NATIVE=OFF
make -j4 && sudo make install
Livox é©±åŠ¨ï¼šæ¨èå®‰è£… livox_ros_driver2ã€‚
ğŸ› ï¸ ç¼–è¯‘æµç¨‹
```


```bashcd ï½/vilota_lidar_ws/src
git clone <æœ¬ä»“åº“åœ°å€>
cd ..
git clone <livox_ros_driver2çš„åœ°å€>
```bash
# å…³é”®ï¼šå¿…é¡»å¸¦ä¸Š ROS1 å‚æ•°ï¼Œå¦åˆ™ livox é©±åŠ¨ä¼šæŠ¥é”™
```bash
catkin_make -DROS_EDITION=ROS1
```bash

â–¶ï¸ è¿è¡ŒæŒ‡å—
åœºæ™¯ä¸€ï¼šå•æ¬¡å»ºå›¾ + åœ¨çº¿å›ç¯ (æœ€å¸¸ç”¨)
ç›®æ ‡ï¼šè·‘ä¸€ä¸ª Bag åŒ…ï¼Œå®æ—¶æ¶ˆé™¤æ¼‚ç§»ï¼Œå¾—åˆ°å®Œç¾çš„åœ°å›¾ã€‚
ä¿®æ”¹é…ç½® (config/hap_livox.yaml):
yaml

ç¼–è¾‘
```bash
loopClosureEnableFlag: true  # å¼€å¯å›ç¯
savePCD: true                # ä¿å­˜ç»“æœ
rootDir: "/home/li/data/result/"  # è®¾ç½®ä¿å­˜è·¯å¾„
```bash
å¯åŠ¨ç¨‹åºï¼š
ç¼–è¾‘
```bash
source devel/setup.bash
roslaunch fast_lio_sam mapping_hap_livox.launch
æ’­æ”¾æ•°æ®ï¼š
```bash
rosbag play your_data.bag
```bash
ç»“æŸï¼šæ’­æ”¾å®ŒåæŒ‰ Ctrl+Cï¼Œç­‰å¾…åœ°å›¾ä¿å­˜å®Œæˆã€‚

åœºæ™¯äºŒï¼šå¤šé˜¶æ®µè”åˆä¼˜åŒ– (Multi-session)
ç›®æ ‡ï¼šæŠŠä¸¤æ®µä¸åŒæ—¶é—´å½•åˆ¶çš„ Bag (Session 01, Session 02) æ‹¼åœ¨ä¸€èµ·ã€‚
ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡æ•°æ® (å‰ç«¯å½•åˆ¶)
ä¿®æ”¹ config/hap_livox.yamlï¼Œå…³é—­åœ¨çº¿å›ç¯ (loopClosureEnableFlag: false)ï¼Œå¼€å¯ savePCD: trueã€‚
è®¾ç½® rootDir: "/home/li/data/session_01/"ï¼Œè·‘ç¬¬ä¸€ä¸ªåŒ…ï¼Œä¿å­˜ã€‚
è®¾ç½® rootDir: "/home/li/data/session_02/"ï¼Œè·‘ç¬¬äºŒä¸ªåŒ…ï¼Œä¿å­˜ã€‚
ç¬¬äºŒæ­¥ï¼šç¦»çº¿ä¼˜åŒ– (åç«¯æ‹¼æ¥)
ä¿®æ”¹ config/multi_session.yaml:
```bash
sessions_dir: "/home/li/data/"      # æ•°æ®æ€»ç›®å½•
central_sess_name: "session_01"     # åŸºå‡†åœ°å›¾
query_sess_name: "session_02"       # å¾…æ‹¼æ¥åœ°å›¾
save_directory: "merged_result/"    # ç»“æœä¿å­˜å
```bash

å¯åŠ¨ä¼˜åŒ–ï¼š
```bash
roslaunch fast_lio_sam multi_session.launch
```bash
æŸ¥çœ‹ç»“æœï¼šç»“æœä¿å­˜åœ¨ merged_result æ–‡ä»¶å¤¹ä¸­ã€‚ä½¿ç”¨ pcl_viewer æŸ¥çœ‹ aft_map.pcdã€‚
åœºæ™¯ä¸‰ï¼šåœ¨çº¿é‡å®šä½
ç›®æ ‡ï¼šæœºå™¨äººåŠ è½½è¿™ä¸€å¼ å»ºå¥½çš„åœ°å›¾ï¼Œè¿›è¡Œå¯¼èˆªå®šä½ã€‚
ä¿®æ”¹é…ç½® (config/online_relocalization.yaml):
```bash
priorDir: "/home/li/data/session_01/"  # æŒ‡å®šå…ˆéªŒåœ°å›¾è·¯å¾„
```bash
å¯åŠ¨é‡å®šä½èŠ‚ç‚¹ï¼š
```bash
roslaunch fast_lio_sam online_relocalization.launch
```bash
å¯åŠ¨å»ºå›¾èŠ‚ç‚¹ (ä½œä¸ºé‡Œç¨‹è®¡è¾“å…¥)ï¼š
æ³¨æ„ï¼šæ­¤æ—¶å»ºå›¾èŠ‚ç‚¹çš„ savePCD å»ºè®®å…³é—­ï¼Œå‡å°‘è´Ÿè½½ã€‚
```bash
roslaunch fast_lio_sam mapping_hap_livox.launch
```bash
åˆå§‹åŒ–ï¼šåœ¨ RViz ä¸­ä½¿ç”¨ 2D Pose Estimate æŒ‰é’®ç»™ä¸€ä¸ªå¤§è‡´åˆå§‹ä½ç½®ã€‚

ç»“æœè¯„ä¼° (Evaluation)
è¿è¡Œå¤šé˜¶æ®µä¼˜åŒ–æˆ–å›ç¯åï¼Œç³»ç»Ÿä¼šç”Ÿæˆè½¨è¿¹æ–‡ä»¶ (LOG/pos_log.txt)ã€‚æ¨èä½¿ç”¨ EVO å·¥å…·å¯¹æ¯”ä¼˜åŒ–å‰åçš„è½¨è¿¹æ•ˆæœã€‚
å®‰è£… EVO
```bash
pip install evo --upgrade --no-binary evo
```bash

å¯¹æ¯”è½¨è¿¹
```bash
ï½/.local/bin/evo_traj tum <(awk '{print  $ 1, $ 2, $ 3, $ 4, $ 5, $ 6, $ 7, $ 8}' LOG/pos_log.txt) --ref=ground_truth.txt -p --plot_mode=xyz
```bash
(æ³¨ï¼šè¯·æ ¹æ®å®é™…æ–‡ä»¶è·¯å¾„è°ƒæ•´å‘½ä»¤)
